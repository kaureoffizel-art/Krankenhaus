<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Prof. Dr. Kenan Privatklinik</title>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
<style>
body{font-family:'Segoe UI',sans-serif;margin:0;background:#f0f4f8;}
header{background:#1e3d59;color:white;padding:20px;text-align:center;font-size:24px;}
.container{padding:20px;}
.card{background:white;padding:20px;margin-bottom:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
input,select,textarea{width:100%;padding:8px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;}
button{padding:10px 16px;border:none;border-radius:6px;cursor:pointer;background:#3498db;color:white;margin-right:5px;}
button.danger{background:#e74c3c;}
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid #ddd;padding:8px;text-align:left;}
th{background:#1e3d59;color:white;}
.status-1{color:red;font-weight:bold;}
.status-2{color:orange;font-weight:bold;}
.status-3{color:goldenrod;font-weight:bold;}
.status-4{color:green;font-weight:bold;}
#calendar{max-width:900px;margin:auto;}
</style>
</head>
<body>

<header>
üè• Prof. Dr. Kenan Privatklinik
<button style="float:right;margin-right:20px;" onclick="logout()">Logout</button>
</header>

<div class="container">

<div id="loginBox" class="card">
<h3>Login</h3>
<input id="username" placeholder="Benutzer">
<input id="password" type="password" placeholder="Passwort">
<button onclick="login()">Einloggen</button>
</div>

<div id="main" style="display:none;">

<div class="card">
<h3>Dashboard</h3>
<div id="stats"></div>
</div>

<div class="card">
<h3>Patientenverwaltung</h3>
<input id="pname" placeholder="Name">
<input id="palter" type="number" placeholder="Alter">
<input id="pdate" type="date" placeholder="Geburtsdatum">
<input id="ptermin" type="datetime-local" placeholder="Termin">
<textarea id="psymptome" placeholder="Symptome"></textarea>
<select id="pstatus">
<option value="1">Dringlichkeit 1 (h√∂chste)</option>
<option value="2">Dringlichkeit 2</option>
<option value="3">Dringlichkeit 3</option>
<option value="4">Dringlichkeit 4 (niedrig)</option>
</select>
<button onclick="addPatient()">Patient hinzuf√ºgen</button>
<button onclick="emergencyPatient()">SCHNELL BEHANDELN</button>
</div>

<div class="card">
<h3>Patientenliste</h3>
<input id="search" placeholder="Suche..." oninput="renderPatients()">
<table>
<thead>
<tr><th>Name</th><th>Alter</th><th>Geburtsdatum</th><th>Termin</th><th>Symptome</th><th>Dringlichkeit</th><th>Aktion</th></tr>
</thead>
<tbody id="patientTable"></tbody>
</table>
</div>

<div class="card" id="adminPanel" style="display:none;">
<h3>Admin Panel ‚Äì Benutzerverwaltung</h3>
<input id="newUser" placeholder="Benutzername">
<input id="newPass" placeholder="Passwort">
<select id="newRole">
<option value="admin">Admin</option>
<option value="doctor">Arzt</option>
<option value="reception">Empfang</option>
</select>
<button onclick="createUser()">Benutzer erstellen</button>
<table>
<thead><tr><th>Benutzer</th><th>Rolle</th><th>L√∂schen</th></tr></thead>
<tbody id="userTable"></tbody>
</table>
</div>

<div class="card">
<h3>Kalender</h3>
<div id="calendar"></div>
</div>

</div>

<!-- Popup zum Bearbeiten -->
<div id="popup" class="card" style="display:none;position:fixed;top:20%;left:50%;transform:translateX(-50%);z-index:1000;background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.3);width:300px;">
<h3>Patient bearbeiten</h3>
<input id="epname" placeholder="Name">
<input id="epalter" type="number" placeholder="Alter">
<input id="epdate" type="date" placeholder="Geburtsdatum">
<input id="eptermin" type="datetime-local" placeholder="Termin">
<textarea id="epsymptome" placeholder="Symptome"></textarea>
<select id="epstatus">
<option value="1">Dringlichkeit 1 (h√∂chste)</option>
<option value="2">Dringlichkeit 2</option>
<option value="3">Dringlichkeit 3</option>
<option value="4">Dringlichkeit 4 (niedrig)</option>
</select>
<button onclick="saveEdit()">Speichern</button>
<button onclick="closePopup()" class="danger">Abbrechen</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
let users = [{username:"admin",password:"admin",role:"admin",fixed:true}];
let patients = [];
let currentUser = null;
let editIndex = null;

// ===== Login =====
function login(){
  let u=document.getElementById("username").value;
  let p=document.getElementById("password").value;
  let user=users.find(x=>x.username===u && x.password===p);
  if(user){
    currentUser=user;
    document.getElementById("loginBox").style.display="none";
    document.getElementById("main").style.display="block";
    if(user.role==="admin") document.getElementById("adminPanel").style.display="block";
    renderUsers();
    renderPatients();
    updateStats();
    renderCalendar();
  } else alert("Login falsch!");
}

// ===== Logout =====
function logout(){
  currentUser=null;
  document.getElementById("main").style.display="none";
  document.getElementById("loginBox").style.display="block";
}

// ===== Patientenverwaltung =====
function addPatient(){
  let p={name:document.getElementById("pname").value,
         alter:document.getElementById("palter").value,
         gebdatum:document.getElementById("pdate").value,
         termin:document.getElementById("ptermin").value,
         symptome:document.getElementById("psymptome").value,
         status:document.getElementById("pstatus").value};
  patients.push(p);
  renderPatients();
  updateStats();
  renderCalendar();
}
function emergencyPatient(){
  let name=prompt("Name des Patienten f√ºr Schnellbehandlung:");
  let p=patients.find(x=>x.name===name);
  if(p){p.status="1"; renderPatients(); updateStats(); renderCalendar(); alert("Patient auf h√∂chste Dringlichkeit gesetzt!");}
  else alert("Patient nicht gefunden!");
}
function renderPatients(){
  let s=document.getElementById("search").value.toLowerCase();
  let tbody=document.getElementById("patientTable");
  tbody.innerHTML="";
  patients.forEach((p,idx)=>{
    if(p.name.toLowerCase().includes(s)){
      let tr=document.createElement("tr");
      tr.innerHTML=`<td>${p.name}</td><td>${p.alter}</td><td>${p.gebdatum}</td><td>${p.termin}</td><td>${p.symptome}</td><td class="status-${p.status}">${p.status}</td>
      <td><button onclick="editPatient(${idx})">Bearbeiten</button>
          <button onclick="deletePatient(${idx})">L√∂schen</button>
          <button onclick="exportPDF(${idx})">PDF</button>
      </td>`;
      tbody.appendChild(tr);
    }
  });
}
function editPatient(idx){
  editIndex=idx;
  let p=patients[idx];
  document.getElementById("epname").value=p.name;
  document.getElementById("epalter").value=p.alter;
  document.getElementById("epdate").value=p.gebdatum;
  document.getElementById("eptermin").value=p.termin;
  document.getElementById("epsymptome").value=p.symptome;
  document.getElementById("epstatus").value=p.status;
  document.getElementById("popup").style.display="block";
}
function saveEdit(){
  if(editIndex===null) return;
  let p=patients[editIndex];
  p.name=document.getElementById("epname").value;
  p.alter=document.getElementById("epalter").value;
  p.gebdatum=document.getElementById("epdate").value;
  p.termin=document.getElementById("eptermin").value;
  p.symptome=document.getElementById("epsymptome").value;
  p.status=document.getElementById("epstatus").value;
  document.getElementById("popup").style.display="none";
  editIndex=null;
  renderPatients();
  renderCalendar();
}
function closePopup(){document.getElementById("popup").style.display="none"; editIndex=null;}
function deletePatient(idx){patients.splice(idx,1); renderPatients(); renderCalendar(); updateStats();}
function updateStats(){document.getElementById("stats").innerText="Gesamt Patienten: "+patients.length;}

// ===== Admin =====
function createUser(){
  if(currentUser.role!=="admin"){alert("Zugriff verweigert"); return;}
  let u=document.getElementById("newUser").value;
  let p=document.getElementById("newPass").value;
  let r=document.getElementById("newRole").value;
  users.push({username:u,password:p,role:r,fixed:false});
  renderUsers();
}
function renderUsers(){
  if(currentUser.role!=="admin") return;
  let table=document.getElementById("userTable");
  table.innerHTML="";
  users.forEach((u,idx)=>{
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${u.username}</td><td>${u.role}</td>`;
    if(!u.fixed){
      let btn=document.createElement("button");
      btn.textContent="L√∂schen";
      btn.onclick=()=>{users.splice(idx,1); renderUsers();};
      tr.appendChild(document.createElement("td")).appendChild(btn);
    } else {
      tr.appendChild(document.createElement("td")).innerText="Fest";
    }
    table.appendChild(tr);
  });
}

// ===== PDF Export =====
function exportPDF(idx){
  let p=patients[idx];
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("Patientenakte ‚Äì Prof. Dr. Kenan Privatklinik",10,20);
  doc.setFontSize(12);
  doc.text(`Name: ${p.name}`,10,40);
  doc.text(`Alter: ${p.alter}`,10,50);
  doc.text(`Geburtsdatum: ${p.gebdatum}`,10,60);
  doc.text(`Termin: ${p.termin}`,10,70);
  doc.text(`Symptome: ${p.symptome}`,10,80);
  doc.text(`Dringlichkeit: ${p.status}`,10,90);
  doc.save(`${p.name}_akte.pdf`);
}

// ===== Kalender =====
let calendar;
function renderCalendar(){
  let events=patients
    .filter(p=>p.termin)
    .map(p=>({title:p.name+' (Dring '+p.status+')',start:p.termin}));
  let calendarEl=document.getElementById('calendar');
  if(calendar) calendar.destroy();
  calendar=new FullCalendar.Calendar(calendarEl,{initialView:'dayGridMonth',events:events});
  calendar.render();
}
</script>

</body>
</html>
